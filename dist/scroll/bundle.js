import{Scene as lt,PerspectiveCamera as dt,WebGLRenderer as pt,Object3D as J,Group as P,TextureLoader as ht,MeshBasicMaterial as ut,TorusBufferGeometry as Q,InstancedMesh as Z,MeshMatcapMaterial as j,BufferAttribute as L,Mesh as M,SphereBufferGeometry as tt,TorusKnotBufferGeometry as et,DoubleSide as mt,TetrahedronBufferGeometry as ft,Vector2 as nt}from"../vendors/three/three.module.js";import{T as l}from"../vendors/three/tween.module.min.js";import{O as yt}from"../vendors/three/OrbitControls.js";const gt=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const C of r.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&o(C)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerpolicy&&(r.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?r.credentials="include":i.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}};gt();const ot=document.querySelector("canvas"),H=new lt;let W=innerWidth/innerHeight;const s=new dt(60,W,.1,100),Y=document.querySelector("#logs"),E=new yt(s,ot);E.addEventListener("change",()=>{const{x:t,y:e,z:n}=s.position,{x:o,y:i,z:r}=s.rotation;Y&&(Y.innerHTML=`pos: (${t.toFixed(4)}, ${e.toFixed(4)}, ${n.toFixed(4)})
rot: (${o.toFixed(4)}, ${i.toFixed(4)}, ${r.toFixed(4)})
`)});const O=new pt({canvas:ot,antialias:!0});O.setSize(innerWidth,innerHeight);O.setPixelRatio(Math.min(window.devicePixelRatio,2));addEventListener("resize",()=>{W=innerWidth/innerHeight,s.aspect=W,s.updateProjectionMatrix(),O.setSize(innerWidth,innerHeight)});let I=!0;window.onkeydown=t=>{t.code==="Space"&&(t.preventDefault(),I?I=!1:(I=!0,rt(it)))};let it;const rt=t=>{it=t;const e=()=>{E.update(),O.render(H,s)};if(!t){const o=()=>{e(),I&&requestAnimationFrame(o)};requestAnimationFrame(o);return}const n=o=>{t(o),e(),I&&requestAnimationFrame(n)};requestAnimationFrame(n)},g=document.querySelector("main");E.domElement=null;E.object=new J;const x=new P;x.add(s);s.position.z=5;H.add(x);let B=-10,w=innerWidth/innerHeight,X=.062,$=Math.PI/4;const at=256,a=new J,wt=new ht,z=new ut({wireframe:!0}),m=new P;H.add(m);const xt=new Q(.5,.033,18,96),f=new Z(xt,new j,16),Mt=Math.PI*2/f.count;for(let t=0;t<f.count;t++){const e=t*Mt,n=.2*Math.cos(e),o=.2*Math.sin(e);a.position.set(n,0,o),a.rotation.set(0,0,0),a.rotateY(-e),a.rotateX(Math.PI/3),a.updateMatrix(),f.setMatrixAt(t,a.matrix)}U("mythril",f.material);f.rotateY(Math.PI/2);const F=new Q(.75,.3,3,256);{const t=F.parameters.tubularSegments*6,e=F.index.array,n=new Float32Array(e.length/6);for(let o=0;o<n.length;o+=3){const i=o*2;n[o+0]=e[i+0],n[o+1]=e[i+1],n[o+2]=e[(i+t)%e.length]}F.setIndex(new L(n,1))}const D=new M(F,z);D.scale.set(1.5,1.5,.333);const y=new P;y.add(f,D);y.position.set(w,0,0);y.rotation.x=y.rotation.y=-$;m.add(y);const vt=new tt(.667,144,2),G=new tt(.62,3,48,0,Math.PI*2,0,Math.PI/2);{let t=G.index.array;t=t.subarray(9,t.length);const e=new Float32Array(t.length/6+3);for(let n=0;n<e.length;n+=3){const o=n*6;e[n+0]=t[o+0],e[n+1]=t[o+3],e[n+2]=t[o+6]}e[e.length-3]=t[t.length-1],e[e.length-2]=t[t.length-2],e[e.length-1]=t[t.length-8],G.setIndex(new L(e,1))}const p=new P,d=new P;d.add(new M(G,z),new M(G,z));d.children[0].position.y=.75;d.children[1].position.y=-.75;d.children[1].rotation.x=Math.PI;const v=new M(vt,new j);v.scale.y=2;v.material.flatShading=!0;U("redstone",v.material);p.add(v,d);p.position.set(-w,B,0);p.children[1].rotation.z=Math.PI/2;p.rotation.z=p.rotation.x=$;m.add(p);const st=3,ct=1,k=new et(1,.125,256,18,st,ct),q=new et(1,.1875,768,3,st,ct);{let t=k.index.array;k.setIndex(new L(t.subarray(t.length/2,t.length),1)),t=q.index.array;const e=new Float32Array(t.length/6);for(let n=0;n<e.length;n+=3){const o=n*6;e[n+0]=t[o+0],e[n+1]=t[o+6],e[n+2]=t[o+12]}q.setIndex(new L(e.subarray(0,e.length/2),1))}const c=new P,A=new M(k,new j);A.material.side=mt;A.material.flatShading=!0;U("nanite",A.material);const Pt=new M(q,z);c.add(A,Pt);c.position.set(w,B*2,0);c.rotation.x=c.rotation.z=$;m.add(c);R();const bt=new ft(.01),N=new Z(bt,z,at);{const t=s.position.distanceTo(H.position),e=s.fov*Math.PI/360,n=2*Math.tan(e)*t;for(let o=0;o<at;o++){a.position.x=(Math.random()-.5)*n*s.aspect,a.position.y=(1-Math.random()*(m.children.length+3))*n,a.position.z=(Math.random()*2-1)*n*s.aspect,a.rotation.set(Math.random(),Math.random(),Math.random());let i=1+Math.random()*4;i=i>4.8?i*i:i,a.scale.set(i,i,i),a.updateMatrix(),N.setMatrixAt(o,a.matrix)}}m.add(N);const T=new nt,S=new nt;addEventListener("pointermove",t=>{T.x=t.clientX/innerWidth*2-1,T.y=-t.clientY/innerHeight*2+1,T.multiplyScalar(.382)});let K=0,h=0;rt(t=>{const e=(T.x-S.x)*X,n=(T.y-S.y)*X;S.x+=e,S.y+=n,x.rotation.y+=e,x.rotation.x+=n,x.position.x+=e,x.position.y+=n,t*=1e-4,h=t-K,K=t,y.rotation.x-=h,y.rotation.z+=h/2,p.rotation.y-=h,p.rotation.z+=h/2,c.rotation.x-=h,c.rotation.y+=h/2,N.rotation.y-=h/4,l.update()});function R(){const t=-g.scrollTop/innerHeight;m.position.y=t*B,m.rotation.y=t*Math.PI*2}function U(t,e){const n=()=>wt.load("https://raw.githubusercontent.com/foretoo/jora/main/src/assets/"+t+".png",o=>{e.matcap=o,e.needsUpdate=!0},void 0,n);n()}let b=Math.round(g.scrollTop/innerHeight);g.addEventListener("scroll",t=>{t.preventDefault(),R();const e=g.scrollTop/innerHeight<=.2?0:g.scrollTop/innerHeight<=1.2&&g.scrollTop/innerHeight>=.8?1:g.scrollTop/innerHeight>=1.8?2:null;e===null||b===e||(b=e,b===0&&!V.isPlaying()?V.to({x:f.rotation.x+Math.PI*3}).start():b===1&&!u.isPlaying()?u.start():b===2&&!_.isPlaying()&&_.to({z:c.rotation.z+Math.PI*4}).start())});addEventListener("resize",()=>{w=innerWidth/innerHeight,y.position.x=w,p.position.x=w,c.position.x=w,R()});const V=new l.Tween(f.rotation).duration(2e3).easing(l.Easing.Cubic.InOut).onUpdate(({x:t})=>{D.rotation.y=t/2}),u={scale:new l.Tween({v:0}).duration(500).easing(l.Easing.Cubic.InOut).yoyo(!0).repeatDelay(1e3).onUpdate(({v:t})=>{const e=2-t,n=1-t*.5;v.scale.set(n,e,n);const o=1+t;d.scale.set(o,o,o),d.children[0].position.y=.75-.75*t,d.children[1].position.y=-.75+.75*t}),rv:0,rotation:new l.Tween({v:0}).duration(1800).easing(l.Easing.Cubic.InOut).delay(100).onUpdate(({v:t})=>{const e=(t-u.rv)*Math.PI*2;v.rotation.x+=e,d.rotation.y+=e,u.rv=t}).onComplete(t=>t.v=0),start:()=>{u.scale.to({v:1}).repeat(1).start(),u.rotation.to({v:1}).start()},isPlaying:()=>u.scale.isPlaying()||u.rotation.isPlaying()},_=new l.Tween(c.rotation).duration(2e3).easing(l.Easing.Cubic.InOut);
