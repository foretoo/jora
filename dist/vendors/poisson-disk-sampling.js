import{m as M}from"./moore.js";function x(t){var i=t.length,e=1,n=new Array(i),s;for(s=i;s>0;s--)n[s-1]=e,e=e*t[s-1];return{stride:n,data:new Uint32Array(e)}}function A(t){var i=t.length,e=1,n=new Array(i),s=[],r,o;for(r=i;r>0;r--)n[r-1]=e,e=e*t[r-1];for(o=0;o<e;o++)s.push([]);return{stride:n,data:s}}var g={integer:x,array:A},y=S;function S(t,i){var e=new Array(t),n=Math.floor(t/2)<<1,s=0,r,o,l,p,u;for(u=0;u<n;u+=2)r=-2*Math.log(i()),o=Math.sqrt(r),l=2*Math.PI*i(),s+=r,e[u]=o*Math.cos(l),e[u+1]=o*Math.sin(l);if(t%2){var c=Math.sqrt(-2*Math.log(i()))*Math.cos(2*Math.PI*i());e[t-1]=c,s+=Math.pow(c,2)}for(p=1/Math.sqrt(s),u=0;u<t;++u)e[u]*=p;return e}var w=M;function b(t){var i=w(2,t),e=[],n;for(i=i.filter(function(s){for(var r=0,o=0;o<t;o++)r+=Math.pow(Math.max(0,Math.abs(s[o])-1),2);return r<t}),n=0;n<t;n++)e.push(0);return i.push(e),i.sort(function(s,r){var o=0,l=0,p;for(p=0;p<t;p++)o+=Math.pow(s[p],2),l+=Math.pow(r[p],2);return o<l?-1:o>l?1:0}),i}var m={};function L(t){return m[t]||(m[t]=b(t)),m[t]}var P=L,q=g.integer,E=y,F=P;function z(t,i){for(var e=0,n=0;n<t.length;n++)e+=Math.pow(t[n]-i[n],2);return e}function h(t,i){if(typeof t.distanceFunction=="function")throw new Error("PoissonDiskSampling: Tried to instantiate the fixed density implementation with a distanceFunction");this.shape=t.shape,this.minDistance=t.minDistance,this.maxDistance=t.maxDistance||t.minDistance*2,this.maxTries=Math.ceil(Math.max(1,t.tries||30)),this.rng=i||Math.random;for(var e=0,n=0;n<this.shape.length;n++)e=Math.max(e,this.shape[n]);var s=Math.max(1,e/128|0),r=1e-14*s;this.dimension=this.shape.length,this.squaredMinDistance=this.minDistance*this.minDistance,this.minDistancePlusEpsilon=this.minDistance+r,this.deltaDistance=Math.max(0,this.maxDistance-this.minDistancePlusEpsilon),this.cellSize=this.minDistance/Math.sqrt(this.dimension),this.neighbourhood=F(this.dimension),this.currentPoint=null,this.processList=[],this.samplePoints=[],this.gridShape=[];for(var n=0;n<this.dimension;n++)this.gridShape.push(Math.ceil(this.shape[n]/this.cellSize));this.grid=q(this.gridShape)}h.prototype.shape=null;h.prototype.dimension=null;h.prototype.minDistance=null;h.prototype.maxDistance=null;h.prototype.minDistancePlusEpsilon=null;h.prototype.squaredMinDistance=null;h.prototype.deltaDistance=null;h.prototype.cellSize=null;h.prototype.maxTries=null;h.prototype.rng=null;h.prototype.neighbourhood=null;h.prototype.currentPoint=null;h.prototype.processList=null;h.prototype.samplePoints=null;h.prototype.gridShape=null;h.prototype.grid=null;h.prototype.addRandomPoint=function(){for(var t=new Array(this.dimension),i=0;i<this.dimension;i++)t[i]=this.rng()*this.shape[i];return this.directAddPoint(t)};h.prototype.addPoint=function(t){var i,e=!0;if(t.length===this.dimension)for(i=0;i<this.dimension&&e;i++)e=t[i]>=0&&t[i]<this.shape[i];else e=!1;return e?this.directAddPoint(t):null};h.prototype.directAddPoint=function(t){var i=0,e=this.grid.stride,n;for(this.processList.push(t),this.samplePoints.push(t),n=0;n<this.dimension;n++)i+=(t[n]/this.cellSize|0)*e[n];return this.grid.data[i]=this.samplePoints.length,t};h.prototype.inNeighbourhood=function(t){var i=this.dimension,e=this.grid.stride,n,s,r,o,l;for(n=0;n<this.neighbourhood.length;n++){for(s=0,r=0;r<i;r++){if(o=(t[r]/this.cellSize|0)+this.neighbourhood[n][r],o<0||o>=this.gridShape[r]){s=-1;break}s+=o*e[r]}if(s!==-1&&this.grid.data[s]!==0&&(l=this.samplePoints[this.grid.data[s]-1],z(t,l)<this.squaredMinDistance))return!0}return!1};h.prototype.next=function(){for(var t,i,e,n,s,r,o;this.processList.length>0;){for(this.currentPoint===null&&(this.currentPoint=this.processList.shift()),n=this.currentPoint,t=0;t<this.maxTries;t++){for(r=!0,e=this.minDistancePlusEpsilon+this.deltaDistance*this.rng(),this.dimension===2?(i=this.rng()*Math.PI*2,s=[Math.cos(i),Math.sin(i)]):s=E(this.dimension,this.rng),o=0;r&&o<this.dimension;o++)s[o]=n[o]+s[o]*e,r=s[o]>=0&&s[o]<this.shape[o];if(r&&!this.inNeighbourhood(s))return this.directAddPoint(s)}t===this.maxTries&&(this.currentPoint=null)}return null};h.prototype.fill=function(){for(this.samplePoints.length===0&&this.addRandomPoint();this.next(););return this.samplePoints};h.prototype.getAllPoints=function(){return this.samplePoints};h.prototype.getAllPointsWithDistance=function(){throw new Error("PoissonDiskSampling: getAllPointsWithDistance() is not available in fixed-density implementation")};h.prototype.reset=function(){var t=this.grid.data,i=0;for(i=0;i<t.length;i++)t[i]=0;this.samplePoints=[],this.currentPoint=null,this.processList.length=0};var I=h,T=g.array,R=y,N=P;function $(t,i){for(var e=0,n=0;n<t.length;n++)e+=Math.pow(t[n]-i[n],2);return Math.sqrt(e)}function a(t,i){if(typeof t.distanceFunction!="function")throw new Error("PoissonDiskSampling: Tried to instantiate the variable density implementation without a distanceFunction");this.shape=t.shape,this.minDistance=t.minDistance,this.maxDistance=t.maxDistance||t.minDistance*2,this.maxTries=Math.ceil(Math.max(1,t.tries||30)),this.distanceFunction=t.distanceFunction,this.bias=Math.max(0,Math.min(1,t.bias||0)),this.rng=i||Math.random;for(var e=0,n=0;n<this.shape.length;n++)e=Math.max(e,this.shape[n]);var s=Math.max(1,e/128|0),r=1e-14*s;this.dimension=this.shape.length,this.minDistancePlusEpsilon=this.minDistance+r,this.deltaDistance=Math.max(0,this.maxDistance-this.minDistancePlusEpsilon),this.cellSize=this.maxDistance/Math.sqrt(this.dimension),this.neighbourhood=N(this.dimension),this.currentPoint=null,this.currentDistance=0,this.processList=[],this.samplePoints=[],this.sampleDistance=[],this.gridShape=[];for(var n=0;n<this.dimension;n++)this.gridShape.push(Math.ceil(this.shape[n]/this.cellSize));this.grid=T(this.gridShape)}a.prototype.shape=null;a.prototype.dimension=null;a.prototype.minDistance=null;a.prototype.maxDistance=null;a.prototype.minDistancePlusEpsilon=null;a.prototype.deltaDistance=null;a.prototype.cellSize=null;a.prototype.maxTries=null;a.prototype.distanceFunction=null;a.prototype.bias=null;a.prototype.rng=null;a.prototype.neighbourhood=null;a.prototype.currentPoint=null;a.prototype.currentDistance=null;a.prototype.processList=null;a.prototype.samplePoints=null;a.prototype.sampleDistance=null;a.prototype.gridShape=null;a.prototype.grid=null;a.prototype.addRandomPoint=function(){for(var t=new Array(this.dimension),i=0;i<this.dimension;i++)t[i]=this.rng()*this.shape[i];return this.directAddPoint(t)};a.prototype.addPoint=function(t){var i,e=!0;if(t.length===this.dimension)for(i=0;i<this.dimension&&e;i++)e=t[i]>=0&&t[i]<this.shape[i];else e=!1;return e?this.directAddPoint(t):null};a.prototype.directAddPoint=function(t){var i=0,e=this.grid.stride,n=this.samplePoints.length,s;for(this.processList.push(n),this.samplePoints.push(t),this.sampleDistance.push(this.distanceFunction(t)),s=0;s<this.dimension;s++)i+=(t[s]/this.cellSize|0)*e[s];return this.grid.data[i].push(n),t};a.prototype.inNeighbourhood=function(t){var i=this.dimension,e=this.grid.stride,n,s,r,o,l,p,u=this.distanceFunction(t);for(n=0;n<this.neighbourhood.length;n++){for(s=0,r=0;r<i;r++){if(o=(t[r]/this.cellSize|0)+this.neighbourhood[n][r],o<0||o>=this.gridShape[r]){s=-1;break}s+=o*e[r]}if(s!==-1&&this.grid.data[s].length>0)for(var c=0;c<this.grid.data[s].length;c++){l=this.samplePoints[this.grid.data[s][c]],p=this.sampleDistance[this.grid.data[s][c]];var f=Math.min(p,u),D=Math.max(p,u),v=f+(D-f)*this.bias;if($(t,l)<this.minDistance+this.deltaDistance*v)return!0}}return!1};a.prototype.next=function(){for(var t,i,e,n,s,r,o,l;this.processList.length>0;){if(this.currentPoint===null){var p=this.processList.shift();this.currentPoint=this.samplePoints[p],this.currentDistance=this.sampleDistance[p]}for(n=this.currentPoint,s=this.currentDistance,t=0;t<this.maxTries;t++){for(o=!0,e=this.minDistancePlusEpsilon+this.deltaDistance*(s+(1-s)*this.bias),this.dimension===2?(i=this.rng()*Math.PI*2,r=[Math.cos(i),Math.sin(i)]):r=R(this.dimension,this.rng),l=0;o&&l<this.dimension;l++)r[l]=n[l]+r[l]*e,o=r[l]>=0&&r[l]<this.shape[l];if(o&&!this.inNeighbourhood(r))return this.directAddPoint(r)}t===this.maxTries&&(this.currentPoint=null)}return null};a.prototype.fill=function(){for(this.samplePoints.length===0&&this.addRandomPoint();this.next(););return this.samplePoints};a.prototype.getAllPoints=function(){return this.samplePoints};a.prototype.getAllPointsWithDistance=function(){var t=new Array(this.samplePoints.length),i=0,e=0,n;for(i=0;i<this.samplePoints.length;i++){for(n=new Array(this.dimension+1),e=0;e<this.dimension;e++)n[e]=this.samplePoints[i][e];n[this.dimension]=this.sampleDistance[i],t[i]=n}return t};a.prototype.reset=function(){var t=this.grid.data,i=0;for(i=0;i<t.length;i++)t[i]=[];this.samplePoints=[],this.currentPoint=null,this.processList.length=0};var k=a,W=I,V=k;function d(t,i){this.shape=t.shape,typeof t.distanceFunction=="function"?this.implementation=new V(t,i):this.implementation=new W(t,i)}d.prototype.implementation=null;d.prototype.addRandomPoint=function(){return this.implementation.addRandomPoint()};d.prototype.addPoint=function(t){return this.implementation.addPoint(t)};d.prototype.next=function(){return this.implementation.next()};d.prototype.fill=function(){return this.implementation.fill()};d.prototype.getAllPoints=function(){return this.implementation.getAllPoints()};d.prototype.getAllPointsWithDistance=function(){return this.implementation.getAllPointsWithDistance()};d.prototype.reset=function(){this.implementation.reset()};var C=d;export{C as p};
